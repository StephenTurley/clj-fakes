<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>clj-fakes.context documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Clj-fakes 0.1.1-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-fakes</span></div></div></li><li class="depth-2 branch current"><a href="clj-fakes.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-2"><a href="clj-fakes.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="clj-fakes.context.html#var-any.3F"><div class="inner"><span>any?</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-ArgsMatcher"><div class="inner"><span>ArgsMatcher</span></div></a></li><li class="depth-2"><a href="clj-fakes.context.html#var-args-match.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>args-match?</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-calls"><div class="inner"><span>calls</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-context"><div class="inner"><span>context</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-default-fake-config"><div class="inner"><span>default-fake-config</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-fake"><div class="inner"><span>fake</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-fake*"><div class="inner"><span>fake*</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-FakeReturnValue"><div class="inner"><span>FakeReturnValue</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-mark-checked"><div class="inner"><span>mark-checked</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-method"><div class="inner"><span>method</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-optional-fake"><div class="inner"><span>optional-fake</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-original-val"><div class="inner"><span>original-val</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-patch.21"><div class="inner"><span>patch!</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-recorded-fake"><div class="inner"><span>recorded-fake</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-recorded-fake*"><div class="inner"><span>recorded-fake*</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-reify-fake"><div class="inner"><span>reify-fake</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-reify-fake*"><div class="inner"><span>reify-fake*</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-reify-nice-fake"><div class="inner"><span>reify-nice-fake</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-reify-nice-fake*"><div class="inner"><span>reify-nice-fake*</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-self-test-unchecked-fakes"><div class="inner"><span>self-test-unchecked-fakes</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-self-test-unused-fakes"><div class="inner"><span>self-test-unused-fakes</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-unpatch.21"><div class="inner"><span>unpatch!</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-unpatch-all.21"><div class="inner"><span>unpatch-all!</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-called"><div class="inner"><span>was-called</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-called-on"><div class="inner"><span>was-called-on</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-called-once"><div class="inner"><span>was-called-once</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-called-once-on"><div class="inner"><span>was-called-once-on</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-not-called"><div class="inner"><span>was-not-called</span></div></a></li><li class="depth-1"><a href="clj-fakes.context.html#var-was-not-called-on"><div class="inner"><span>was-not-called-on</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">clj-fakes.context</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-any.3F"><h3>any?</h3><div class="usage"><code>(any? _)</code></div><div class="doc"><div class="markdown"><p>Matcher which matches any value.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L68">view source</a></div></div><div class="public anchor" id="var-ArgsMatcher"><h3>ArgsMatcher</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-args-match.3F"><h3>args-match?</h3><div class="usage"><code>(args-match? this args)</code></div><div class="doc"><div class="markdown"><p>Should return true or false.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L45">view source</a></div></div><div class="public anchor" id="var-calls"><h3>calls</h3><div class="usage"><code>(calls ctx)</code><code>(calls ctx k)</code></div><div class="doc"><div class="markdown"><p>For the specified recorded fake returns a vector of its calls.</p><p>If fake is not specified then it will return all the calls recorded in the context: [[recorded-fake1 call1]
 [recorded-fake2 call2]  &hellip;]</p><p>A call is a map with keys: :args, :return-value.</p><p>Returned vector is ordered by call time: the earliest call will be at the head.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L281">view source</a></div></div><div class="public anchor" id="var-context"><h3>context</h3><div class="usage"><code>(context)</code></div><div class="doc"><div class="markdown"><p>Creates a new context atom. Do not alter the atom manually, context fields should be considered a private API.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L14">view source</a></div></div><div class="public anchor" id="var-default-fake-config"><h3>default-fake-config</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>With this config fake will return a unique value for any combination of args.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L193">view source</a></div></div><div class="public anchor" id="var-fake"><h3>fake</h3><h4 class="type">macro</h4><div class="usage"><code>(fake ctx config)</code></div><div class="doc"><div class="markdown"><p>Creates a fake function. The created function must be called; otherwise, |self-test-unused-fakes| will fail. It&rsquo;s made a macro instead of a function to be able to catch fake creation position for better error messages. Use |fake*| in case this macro is called from another macro in order to correctly detect positions.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L239">view source</a></div></div><div class="public anchor" id="var-fake*"><h3>fake*</h3><h4 class="type">macro</h4><div class="usage"><code>(fake* ctx form config)</code></div><div class="doc"><div class="markdown"><p>The same as |fake| macro but for reuse in other macros. |form| must be passed from the parent macro in order to correctly detect positions of fakes.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L232">view source</a></div></div><div class="public anchor" id="var-FakeReturnValue"><h3>FakeReturnValue</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Empty protocol with meaningful name for creating unique return values.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L173">view source</a></div></div><div class="public anchor" id="var-mark-checked"><h3>mark-checked</h3><div class="usage"><code>(mark-checked ctx k)</code></div><div class="doc"><div class="markdown"><p>After using this function self-test will not warn about the specified recorded fake.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L167">view source</a></div></div><div class="public anchor" id="var-method"><h3>method</h3><div class="usage"><code>(method ctx obj f)</code></div><div class="doc"><div class="markdown"><p>Returns a hash-key by which calls are recorded for the specified fake protocol instance method. Can be used in functions which take recorded fake as an input.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L317">view source</a></div></div><div class="public anchor" id="var-optional-fake"><h3>optional-fake</h3><div class="usage"><code>(optional-fake ctx)</code><code>(optional-fake ctx config)</code></div><div class="doc"><div class="markdown"><p>Creates an optional fake function which will not be checked by |self-test-unused-fakes|, i.e. created fake is allowed to be never called. If |config| is not specified then fake will be created with |default-fake-config|.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L197">view source</a></div></div><div class="public anchor" id="var-original-val"><h3>original-val</h3><div class="usage"><code>(original-val ctx a-var)</code></div><div class="doc"><div class="markdown"><p>Given a patched var returns its original value.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L873">view source</a></div></div><div class="public anchor" id="var-patch.21"><h3>patch!</h3><h4 class="type">macro</h4><div class="usage"><code>(patch! ctx var-expr val)</code></div><div class="doc"><div class="markdown"><p>Changes variable value in all threads.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L893">view source</a></div></div><div class="public anchor" id="var-recorded-fake"><h3>recorded-fake</h3><h4 class="type">macro</h4><div class="usage"><code>(recorded-fake ctx)</code><code>(recorded-fake ctx config)</code></div><div class="doc"><div class="markdown"><p>Creates a fake function which calls will be recorded. Ultimatelly, the created function must be marked checked; otherwise, |self-test-unchecked-fakes| will fail. It&rsquo;s made a macro instead of a function to be able to catch fake creation position for better error messages. Use |recorded-fake*| in case this macro is called from another macro in order to correctly detect positions.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L260">view source</a></div></div><div class="public anchor" id="var-recorded-fake*"><h3>recorded-fake*</h3><h4 class="type">macro</h4><div class="usage"><code>(recorded-fake* ctx form)</code><code>(recorded-fake* ctx form config)</code></div><div class="doc"><div class="markdown"><p>This is the same as |recorded-fake| macro but for reuse in other macros. |form| must be passed from the parent macro in order to correctly detect positions of fakes.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L253">view source</a></div></div><div class="public anchor" id="var-reify-fake"><h3>reify-fake</h3><h4 class="type">macro</h4><div class="usage"><code>(reify-fake ctx &amp; specs)</code></div><div class="doc"><div class="markdown"><p>Works similarly to |reify| macro but implements methods in terms of fake functions. Created instance will raise an exception on calling protocol method which is not defined.</p><p>Supported fake types: :optional-fake, :fake, :recorded-fake.</p><p>Syntax example: (reify-fake my-context  protocol-or-interface-or-Object  [method1 :optional-fake [any? 123]]  protocol-or-interface-or-Object  [method2 :recorded-fake])</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L728">view source</a></div></div><div class="public anchor" id="var-reify-fake*"><h3>reify-fake*</h3><h4 class="type">macro</h4><div class="usage"><code>(reify-fake* ctx form env &amp; specs)</code></div><div class="doc"><div class="markdown"><p>The same as |reify-fake| but to be used inside the macros. |form| is needed to correctly determine fake positions, |env| is needed to determine target language.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L714">view source</a></div></div><div class="public anchor" id="var-reify-nice-fake"><h3>reify-nice-fake</h3><h4 class="type">macro</h4><div class="usage"><code>(reify-nice-fake ctx &amp; specs)</code></div><div class="doc"><div class="markdown"><p>Works similarly to |reify-fake| but automatically generates :optional-fake implementations for methods which are not explicitly defined by user.</p><p>It cannot yet automatically fake Java interface and Object methods.</p><p>Supported fake types: :optional-fake, :fake, :recorded-fake.</p><p>Syntax example: (reify-nice-fake my-context  protocol-or-interface-or-Object  [method1 :optional-fake [any? 123]]  protocol-or-interface-or-Object  [method2 :recorded-fake])</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L744">view source</a></div></div><div class="public anchor" id="var-reify-nice-fake*"><h3>reify-nice-fake*</h3><h4 class="type">macro</h4><div class="usage"><code>(reify-nice-fake* ctx form env &amp; specs)</code></div><div class="doc"><div class="markdown"><p>The same as |reify-nice-fake| but to be used inside macros. |form| is needed to correctly determine fake positions, |env| is needed to determine target language.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L721">view source</a></div></div><div class="public anchor" id="var-self-test-unchecked-fakes"><h3>self-test-unchecked-fakes</h3><div class="usage"><code>(self-test-unchecked-fakes ctx)</code></div><div class="doc"><div class="markdown"><p>Raises an exception if some recorded fake was never marked checked, i.e. you forgot assert its calls.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L781">view source</a></div></div><div class="public anchor" id="var-self-test-unused-fakes"><h3>self-test-unused-fakes</h3><div class="usage"><code>(self-test-unused-fakes ctx)</code></div><div class="doc"><div class="markdown"><p>Raises an exception when some fake was never called after its creation.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L771">view source</a></div></div><div class="public anchor" id="var-unpatch.21"><h3>unpatch!</h3><div class="usage"><code>(unpatch! ctx a-var)</code></div><div class="doc"><div class="markdown"><p>Restores original variable value.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L903">view source</a></div></div><div class="public anchor" id="var-unpatch-all.21"><h3>unpatch-all!</h3><div class="usage"><code>(unpatch-all! ctx)</code></div><div class="doc"><div class="markdown"><p>Restores original values for all the variables patched in the specified context.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L910">view source</a></div></div><div class="public anchor" id="var-was-called"><h3>was-called</h3><div class="usage"><code>(was-called ctx k)</code><code>(was-called ctx k args-matcher)</code></div><div class="doc"><div class="markdown"><p>Checks that recorded fake was called at least once with the specified args.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L824">view source</a></div></div><div class="public anchor" id="var-was-called-on"><h3>was-called-on</h3><div class="usage"><code>(was-called-on ctx obj f)</code><code>(was-called-on ctx obj f args-matcher)</code></div><div class="doc"><div class="markdown"><p>|was-called| for protocol method fakes.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L848">view source</a></div></div><div class="public anchor" id="var-was-called-once"><h3>was-called-once</h3><div class="usage"><code>(was-called-once ctx k)</code><code>(was-called-once ctx k args-matcher)</code></div><div class="doc"><div class="markdown"><p>Checks that recorded fake was called strictly once and that the call was with the specified args.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L817">view source</a></div></div><div class="public anchor" id="var-was-called-once-on"><h3>was-called-once-on</h3><div class="usage"><code>(was-called-once-on ctx obj f)</code><code>(was-called-once-on ctx obj f args-matcher)</code></div><div class="doc"><div class="markdown"><p>|was-called-once| for protocol method fakes.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L841">view source</a></div></div><div class="public anchor" id="var-was-not-called"><h3>was-not-called</h3><div class="usage"><code>(was-not-called ctx k)</code></div><div class="doc"><div class="markdown"><p>Checks that recorded fake was never called.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L831">view source</a></div></div><div class="public anchor" id="var-was-not-called-on"><h3>was-not-called-on</h3><div class="usage"><code>(was-not-called-on ctx obj f)</code></div><div class="doc"><div class="markdown"><p>|was-not-called| for protocol method fakes.</p></div></div><div class="src-link"><a href="https://github.com/metametadata/clj-fakes/blob/master/src/clj_fakes/context.cljc#L855">view source</a></div></div></div></body></html>